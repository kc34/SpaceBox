<!DOCTYPE html>
<html>
<head>
<title>SpaceBox</title>
<link rel='shortcut icon' href='assets/favicon.ico' type='image/x-icon'/ >
</head>
<body>

<canvas id="myCanvas">
Your browser does not support the canvas element.
</canvas>

<style>
html, body {
  width:  100%;
  height: 100%;
  margin: 0px;
  overflow: hidden;
}
</style>

<script src="js/model/model.js"></script>
<script src="js/view/viewer.js"></script>
<script src="js/model/bodies.js"></script>
<script src="js/util/vector.js"></script>
<script src="assets/easing.js"></script>
<script src="assets/graphics.js"></script>

<script>
"use strict";
/**
 * 	Changelog:
 *  - Moved things around
 *  - Merged Controller into Viewer
 */

/**
 * 	Begin by creating our favorite singletons.
 */

var myViewer;
var myModel;

function init() {
  myViewer = new Viewer();
  myModel = new Sector();
};

/**
 * 	Other important global variables (e.g. time-keeping, environment)
 */

var TIME_STEP = 1.0 / 60; // Time-step. Measured in seconds.
var totalElapsedTime = 0.0;
var accumulator = 0.0;
var currentTime = new Date();

/**
 * 	Runs physics-model and rendering separately, but on same thread.
 */
function main() {

	var newTime = new Date();
	var frameTime = (newTime - currentTime) / 1000;

	if (frameTime > 0.1) {
		frameTime = 0.1;
	}
	currentTime = newTime;

	accumulator += frameTime;
	while ( accumulator >= TIME_STEP ) {
		myModel.update(TIME_STEP);
		totalElapsedTime += TIME_STEP;
		accumulator -= TIME_STEP;
	}

	myViewer.draw();
}

var canvas = document.getElementById("myCanvas");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/** Event: Mousedown followed by mouseup. */
canvas.addEventListener('click', function(event) {
	myViewer["clickHandler"]({x : event.clientX, y : event.clientY});
}, false);

/** Event: Left mousebutton press on the canvas. */
canvas.addEventListener('mousedown', function(event) {
	myViewer["mousedownHandler"]({x : event.clientX, y : event.clientY});
}, false);

/** Event: Left mousebutton release on the canvas. */
canvas.addEventListener('mouseup', function(event) {
	myViewer["mouseupHandler"]({x : event.clientX, y : event.clientY});
}, false);

/** Event: Any movement of the mouse over the canvas. */
canvas.addEventListener('mousemove', function(event) {
	myViewer["mousemoveHandler"]({x : event.clientX, y : event.clientY});
}, false);

/** Event: Movement of the mousewheel. */
window.addEventListener('mousewheel', function(event) {
  event.preventDefault();
	myViewer["mousewheelHandler"](event);
}, false);

/** Firefox mousewheel */
canvas.addEventListener("DOMMouseScroll", function(event) {
  console.log(event);
	myViewer["mousewheelHandler"]({clientX : event.clientX, clientY : event.clientY, wheelDelta : event.detail * -1});
}, false);

canvas.onmousedown = function(){ return false; };

var ctx = canvas.getContext("2d");

/** Event: Any key press. */
window.addEventListener('keydown', function(key) {
	myViewer.keydownHandler(key);
}, false);

init();

var mainLooper = setInterval(main, 1000 * TIME_STEP);

</script>

</body>
</html>
